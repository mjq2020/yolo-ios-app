# 📱 YOLOiOSApp 项目结构说明文档

> 本文档详细介绍 YOLOiOSApp 项目的目录结构、文件作用及 iOS 开发相关知识

---

## 🗂️ 项目目录结构总览

```
YOLOiOSApp/
├── 📁 YOLOiOSApp/                    # 源代码目录
│   ├── 📄 AppDelegate.swift          # 🚀 程序入口
│   ├── 📄 ViewController.swift       # 主界面控制器
│   ├── 📄 ModelDownloadManager.swift # 模型下载管理
│   ├── 📄 RemoteModels.swift         # 远程模型配置
│   ├── 📄 Main.storyboard            # 主界面布局
│   ├── 📄 LaunchScreen.storyboard    # 启动画面
│   ├── 📄 Info.plist                 # 应用配置
│   ├── 📁 Assets.xcassets/           # 图片资源
│   ├── 📁 Settings.bundle/           # 设置页配置
│   └── 🖼️ ultralytics_yolo_logotype.png
│
├── 📁 YOLOiOSApp.xcodeproj/          # Xcode 工程文件
├── 📁 DetectModels/                  # 目标检测模型
├── 📁 SegmentModels/                 # 语义分割模型
├── 📁 ClassifyModels/                # 图像分类模型
├── 📁 PoseModels/                    # 姿态估计模型
├── 📁 OBBModels/                     # 旋转框检测模型
└── 📄 README.md                      # 项目说明
```

---

## 📂 目录详细说明

### 1️⃣ YOLOiOSApp/ - 源代码目录

这是存放所有源代码和资源文件的主目录。

#### 📄 Swift 源文件

| 文件名 | 作用 | 详细说明 |
|--------|------|----------|
| **AppDelegate.swift** | 🚀 程序入口 | iOS 应用的入口文件，处理应用生命周期事件（启动、进入后台、被终止等）。`@UIApplicationMain` 标记表示这是应用的入口类。 |
| **ViewController.swift** | 🎮 主界面控制器 | 管理主界面的所有交互逻辑，包括：任务切换、模型选择、相机控制、结果显示等。继承自 `UIViewController`。 |
| **ModelDownloadManager.swift** | 📥 模型管理 | 包含三个核心类：`ModelEntry`（模型信息）、`ModelCacheManager`（缓存管理）、`ModelDownloadManager`（下载管理）。 |
| **RemoteModels.swift** | ☁️ 远程模型配置 | 定义可从网络下载的 YOLO 模型列表及其下载 URL。 |

#### 📄 界面布局文件 (Storyboard)

| 文件名 | 作用 | 详细说明 |
|--------|------|----------|
| **Main.storyboard** | 主界面布局 | 使用 Interface Builder 可视化设计的主界面。定义了 `YOLOView`、`SegmentedControl`、标签等 UI 组件的位置和约束。 |
| **LaunchScreen.storyboard** | 启动画面 | 应用启动时显示的闪屏界面，展示 Ultralytics Logo。iOS 会在应用加载完成前显示此界面。 |

#### 📄 配置文件

| 文件名 | 作用 | 详细说明 |
|--------|------|----------|
| **Info.plist** | 应用配置 | XML 格式的配置文件，包含应用的所有元数据和权限声明。 |

##### Info.plist 关键配置项：

```xml
<!-- 应用显示名称 -->
<key>CFBundleDisplayName</key>
<string>Ultralytics YOLO</string>

<!-- 版本号 -->
<key>CFBundleShortVersionString</key>
<string>1.0.0</string>

<!-- 相机权限说明（必须填写，否则无法使用相机） -->
<key>NSCameraUsageDescription</key>
<string>Ultralytics YOLO uses your camera to detect objects...</string>

<!-- 相册读取权限 -->
<key>NSPhotoLibraryUsageDescription</key>
<string>To see images in Photo Library...</string>

<!-- 相册写入权限 -->
<key>NSPhotoLibraryAddUsageDescription</key>
<string>To save results to Photo Library.</string>

<!-- 支持的设备方向 -->
<key>UISupportedInterfaceOrientations</key>
<array>
    <string>UIInterfaceOrientationPortrait</string>
    <string>UIInterfaceOrientationLandscapeLeft</string>
    <string>UIInterfaceOrientationLandscapeRight</string>
</array>

<!-- 入口 Storyboard -->
<key>UIMainStoryboardFile</key>
<string>Main</string>
```

---

### 2️⃣ Assets.xcassets/ - 图片资源目录

iOS 使用 Asset Catalog 管理图片资源，支持自动适配不同分辨率设备。

```
Assets.xcassets/
├── Contents.json                     # 资源目录配置
├── AppIcon.appiconset/               # 应用图标
│   ├── Contents.json                 # 图标配置（定义各尺寸对应的文件）
│   └── ultralytics_yolo_logomark_blue_1024x1024.png  # 1024x1024 图标
└── Focus.imageset/                   # 对焦框图片
    ├── Contents.json                 # 图片配置
    └── ultralytics_square_focus_image.png
```

#### 为什么使用 Asset Catalog？

| 优势 | 说明 |
|------|------|
| **自动适配** | 系统自动选择 @1x/@2x/@3x 图片 |
| **App Thinning** | App Store 只下载设备需要的资源 |
| **Dark Mode** | 可配置深色模式下的替代图片 |
| **PDF 向量图** | 支持向量图自动生成各尺寸 |

---

### 3️⃣ Settings.bundle/ - 系统设置页配置

允许在 iOS "设置" App 中显示应用的配置项。

```
Settings.bundle/
├── Root.plist          # 设置页面结构定义
└── en.lproj/           # 英语本地化
    └── Root.strings    # 翻译字符串
```

用户路径：`设置 → Ultralytics YOLO → 查看版本号等信息`

---

### 4️⃣ YOLOiOSApp.xcodeproj/ - Xcode 工程目录

这是 Xcode 的工程配置目录，**不要手动修改这些文件**。

```
YOLOiOSApp.xcodeproj/
├── project.pbxproj                   # ⚠️ 核心配置文件（文件列表、编译设置等）
├── project.xcworkspace/              # 工作区配置
│   ├── contents.xcworkspacedata      # 工作区内容
│   └── xcshareddata/
│       └── swiftpm/
│           └── Package.resolved      # Swift Package 依赖版本锁定
├── xcshareddata/
│   └── xcschemes/
│       └── YOLOiOSApp.xcscheme       # 编译方案配置
└── xcuserdata/                       # 用户个人配置（不提交到 Git）
    └── [用户名].xcuserdatad/
        └── UserInterfaceState.xcuserstate  # IDE 状态
```

#### 关键文件说明：

| 文件 | 作用 | 是否提交 Git |
|------|------|-------------|
| **project.pbxproj** | 项目所有配置（编译设置、文件引用、Target 等） | ✅ 是 |
| **xcscheme** | 编译、运行、测试方案 | ✅ 是 |
| **Package.resolved** | SPM 依赖版本锁定 | ✅ 是 |
| **xcuserdata/** | 用户个人配置 | ❌ 否 |

---

### 5️⃣ 模型目录 (DetectModels/, SegmentModels/, 等)

存放预置的 Core ML 模型文件。

```
DetectModels/
└── yolov8s.mlpackage/               # YOLOv8 Small 检测模型
    ├── Manifest.json                # 模型清单
    └── Data/
        └── com.apple.CoreML/
            ├── model.mlmodel        # 模型定义
            └── weights/
                └── weight.bin       # 模型权重（神经网络参数）
```

#### 模型文件格式说明：

| 格式 | 说明 |
|------|------|
| **.mlmodel** | Core ML 模型源文件（可被 Xcode 编译） |
| **.mlpackage** | 打包格式，包含模型和权重（推荐） |
| **.mlmodelc** | 编译后的模型（运行时使用，更快） |

#### 各任务模型目录：

| 目录 | 任务类型 | 用途 |
|------|----------|------|
| **DetectModels/** | 目标检测 | 检测图像中的物体，输出边界框 |
| **SegmentModels/** | 语义分割 | 像素级分割，输出分割遮罩 |
| **ClassifyModels/** | 图像分类 | 判断整张图像的类别 |
| **PoseModels/** | 姿态估计 | 检测人体关键点（骨架） |
| **OBBModels/** | 旋转框检测 | 检测带角度的边界框 |

---

## 🔄 应用启动流程

```
┌─────────────────────────────────────────────────────────────┐
│                    iOS 系统启动应用                          │
└────────────────────────────┬────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────┐
│  1. 显示 LaunchScreen.storyboard（启动画面）                 │
└────────────────────────────┬────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────┐
│  2. 读取 Info.plist 获取配置                                 │
│     - @UIApplicationMain → 找到 AppDelegate                 │
│     - UIMainStoryboardFile → 加载 Main.storyboard           │
└────────────────────────────┬────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────┐
│  3. 创建 AppDelegate 实例                                    │
│     调用 application(_:didFinishLaunchingWithOptions:)      │
│     - 禁用屏幕自动锁定                                       │
│     - 启用电池监控                                           │
│     - 保存版本号和设备 UUID                                  │
└────────────────────────────┬────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────┐
│  4. 从 Main.storyboard 创建 ViewController                   │
│     调用 viewDidLoad()                                       │
│     - 初始化任务分段控件                                      │
│     - 加载本地模型文件列表                                    │
│     - 设置模型选择表格                                       │
│     - 配置 YOLOView 和代理                                   │
│     - 加载默认模型（Detect - yolov8s）                       │
└────────────────────────────┬────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────┐
│  5. 开始实时推理                                             │
│     - 启动相机捕获                                           │
│     - 每帧送入 YOLO 模型                                     │
│     - 绘制检测结果                                           │
│     - 更新 FPS 显示                                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 📱 界面组件结构 (Main.storyboard)

```
┌──────────────────────────────────────────────────────────────┐
│                        ViewController                        │
│  ┌────────────────────────────────────────────────────────┐ │
│  │                      YOLOView                          │ │
│  │  ┌──────────────────────────────────────────────────┐  │ │
│  │  │              labelName (模型名称)                 │  │ │
│  │  └──────────────────────────────────────────────────┘  │ │
│  │  ┌──────────────────────────────────────────────────┐  │ │
│  │  │ Classify │ Segment │ Detect │ Pose │ OBB        │  │ │
│  │  │              segmentedControl                    │  │ │
│  │  └──────────────────────────────────────────────────┘  │ │
│  │  ┌──────────────────────────────────────────────────┐  │ │
│  │  │              labelFPS (帧率/延迟)                 │  │ │
│  │  └──────────────────────────────────────────────────┘  │ │
│  │                                                        │ │
│  │  ┌────────────────┐                                   │ │
│  │  │  modelTableView │  (模型列表)                      │ │
│  │  │  ┌────────────┐│                                   │ │
│  │  │  │  yolov8s   ││                                   │ │
│  │  │  │  yolo11n ☁️ ││                                   │ │
│  │  │  │  yolo11s ☁️ ││                                   │ │
│  │  │  └────────────┘│                                   │ │
│  │  └────────────────┘                                   │ │
│  │                                                        │ │
│  │      ┌─────────────────────────────────────────┐      │ │
│  │      │                                         │      │ │
│  │      │            相机预览 + 检测结果           │      │ │
│  │      │                                         │      │ │
│  │      │     ┌─────────────────┐                │      │ │
│  │      │     │    focus 对焦框  │                │      │ │
│  │      │     └─────────────────┘                │      │ │
│  │      │                                         │      │ │
│  │      └─────────────────────────────────────────┘      │ │
│  │                                                        │ │
│  │  ┌────────────┐              ┌─────────────────────┐  │ │
│  │  │labelVersion│              │      logoImage      │  │ │
│  │  │ v1.0.0 (1) │              │  Ultralytics Logo   │  │ │
│  │  └────────────┘              └─────────────────────┘  │ │
│  │                                                        │ │
│  │  ┌────────────────────────────────────────────────┐   │ │
│  │  │  activityIndicator (加载中转圈)                 │   │ │
│  │  │  downloadProgressView (下载进度条)              │   │ │
│  │  │  downloadProgressLabel (下载百分比)             │   │ │
│  │  └────────────────────────────────────────────────┘   │ │
│  └────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────┘
```

---

## 🧩 核心类关系图

```
                          ┌─────────────────────┐
                          │    AppDelegate      │
                          │  (@UIApplicationMain)│
                          └──────────┬──────────┘
                                     │ 创建
                                     ↓
                          ┌─────────────────────┐
                          │   ViewController    │
                          │  (UIViewController) │
                          └──────────┬──────────┘
                                     │
           ┌─────────────┬───────────┼───────────┬─────────────┐
           ↓             ↓           ↓           ↓             ↓
    ┌────────────┐ ┌──────────┐ ┌─────────┐ ┌─────────┐ ┌──────────┐
    │  YOLOView  │ │TableView │ │Segmented│ │ Labels  │ │  Logo    │
    │  (相机+AI) │ │(模型列表)│ │ Control │ │(名称/FPS)│ │ (点击)   │
    └─────┬──────┘ └────┬─────┘ └────┬────┘ └─────────┘ └──────────┘
          │             │            │
          │  ←──────────┼────────────┘
          ↓             ↓
    ┌─────────────────────────────────────────────────────────────┐
    │                    Model Loading Flow                       │
    │  ┌─────────────────┐      ┌──────────────────────────────┐ │
    │  │ModelCacheManager│─────→│   ModelDownloadManager       │ │
    │  │     (缓存)      │      │   (下载 + 编译)               │ │
    │  └────────┬────────┘      └──────────────────────────────┘ │
    │           │                                                 │
    │           ↓                                                 │
    │  ┌─────────────────┐                                       │
    │  │  MLModel (CoreML)│                                      │
    │  │   编译后的模型   │                                       │
    │  └─────────────────┘                                       │
    └─────────────────────────────────────────────────────────────┘
```

---

## 📚 iOS 开发知识点

### 1. MVC 架构模式

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│    Model    │ ←── │  Controller │ ──→ │    View     │
│   (数据层)   │     │   (控制层)  │     │   (视图层)  │
├─────────────┤     ├─────────────┤     ├─────────────┤
│ MLModel     │     │ViewController│    │ YOLOView    │
│ ModelEntry  │     │             │     │ Storyboard  │
│ RemoteModels│     │             │     │ Labels      │
└─────────────┘     └─────────────┘     └─────────────┘
```

### 2. 常用 iOS 框架

| 框架 | 用途 | 本项目使用场景 |
|------|------|---------------|
| **UIKit** | 用户界面 | 所有 UI 组件 |
| **CoreML** | 机器学习 | 运行 YOLO 模型 |
| **AVFoundation** | 音视频 | 相机捕获 |
| **Foundation** | 基础类型 | 网络、文件操作 |

### 3. 重要设计模式

| 模式 | 实现 | 说明 |
|------|------|------|
| **单例** | `ModelCacheManager.shared` | 全局唯一实例 |
| **代理** | `YOLOViewDelegate` | 事件回调 |
| **MVC** | Model/View/Controller 分离 | 架构组织 |

### 4. 内存管理

```swift
// weak 避免循环引用
@IBOutlet weak var yoloView: YOLOView!

// [weak self] 避免闭包循环引用
completion { [weak self] result in
    guard let self = self else { return }
    self.updateUI()
}
```

---

## 🛠️ 开发环境要求

| 项目 | 要求 |
|------|------|
| **Xcode** | 15.0+ |
| **Swift** | 5.9+ |
| **iOS 部署目标** | iOS 14.0+ |
| **设备** | 需要 arm64 架构（真机测试） |

---

## 📖 学习建议

### 入门顺序：

1. **AppDelegate.swift** - 了解应用入口和生命周期
2. **Info.plist** - 理解应用配置
3. **Main.storyboard** - 了解界面布局（可视化）
4. **ViewController.swift** - 学习界面交互逻辑
5. **ModelDownloadManager.swift** - 学习网络和文件操作
6. **RemoteModels.swift** - 简单的配置文件

### 推荐学习资源：

- [Apple Developer Documentation](https://developer.apple.com/documentation/)
- [Swift 官方教程](https://docs.swift.org/swift-book/)
- [Hacking with Swift](https://www.hackingwithswift.com/)
- [Stanford CS193p](https://cs193p.sites.stanford.edu/)

---

## 📝 常见问题

### Q: 如何添加自己的模型？

1. 将 `.mlmodel` 或 `.mlpackage` 文件放入对应的模型目录
2. 确保文件被添加到 Xcode 项目中（Target Membership）
3. 运行应用，模型会自动出现在列表中

### Q: 为什么模拟器上无法运行？

Core ML 模型和相机功能需要在真机上测试。模拟器不支持：
- Neural Engine 加速
- 相机捕获
- 某些 GPU 操作

### Q: 如何查看模型推理性能？

界面上会实时显示：
- **FPS**: 每秒处理帧数
- **ms**: 单次推理耗时

---

*文档最后更新：2024年*

